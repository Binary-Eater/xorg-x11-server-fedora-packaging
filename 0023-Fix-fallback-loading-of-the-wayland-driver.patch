From 7e1b4d2a4853e7a6c31e0ab0c1fe3405ec61c914 Mon Sep 17 00:00:00 2001
From: Giovanni Campagna <gcampagn@redhat.com>
Date: Fri, 13 Sep 2013 15:52:30 +0200
Subject: [PATCH 23/38] Fix fallback loading of the wayland driver

Fix the array name to actually compile, and fix the driver name
with the new upstream.
---
 hw/xfree86/common/xf86AutoConfig.c | 2 +-
 hw/xfree86/common/xf86Config.c     | 2 +-
 2 files changed, 2 insertions(+), 2 deletions(-)

diff --git a/hw/xfree86/common/xf86AutoConfig.c b/hw/xfree86/common/xf86AutoConfig.c
index a3e1fa7..51a7960 100644
--- a/hw/xfree86/common/xf86AutoConfig.c
+++ b/hw/xfree86/common/xf86AutoConfig.c
@@ -277,7 +277,7 @@ listPossibleVideoDrivers(char *matches[], int nmatches)
     if (i < (nmatches - 1)) {
 #ifdef XORG_WAYLAND
         if (xorgWayland)
-            matches[i++] = xnfstrdup("wlshm");
+            matches[i++] = xnfstrdup("wayland");
         else
 #endif
 #if !defined(__linux__) && defined(__sparc__)
diff --git a/hw/xfree86/common/xf86Config.c b/hw/xfree86/common/xf86Config.c
index aebfc1b..66f98b2 100644
--- a/hw/xfree86/common/xf86Config.c
+++ b/hw/xfree86/common/xf86Config.c
@@ -521,7 +521,7 @@ fixup_video_driver_list(char **drivers)
 {
     static const char *fallback_hw[4] = { "fbdev", "vesa", "wsfb", NULL };
 #ifdef XORG_WAYLAND
-    static const char *fallback_wayland[2] = { "wlshm", NULL };
+    static const char *fallback_wl[2] = { "wayland", NULL };
 #endif
     const char **fallbacks;
     char **end, **drv;
-- 
1.8.4.2

